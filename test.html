<!DOCTYPE html>
<html lang="fr" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DefiTech - Uploader d'Assets Syst√®me</title>
    <!-- Tailwind CSS (Assuming it's available or using CDN for this standalone tool) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="app/static/js/cloudinary_uploader.js"></script>
  </head>
  <body class="bg-gray-100 p-10 font-sans">
    <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
      <h1 class="text-3xl font-bold mb-2 text-gray-800 flex items-center gap-3">
        üì¶ Uploader d'Assets Syst√®me
      </h1>
      <p class="mb-8 text-gray-600 border-b pb-4">
        Uploader centralis√© pour les assets visuels du site (Favicons, Logos,
        Banni√®res). Ces fichiers seront stock√©s dans le dossier
        <code>assets</code> de Cloudinary.
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Favicon Section -->
        <div class="space-y-4">
          <h2
            class="font-semibold text-lg text-gray-700 flex items-center gap-2"
          >
            <span class="bg-blue-100 text-blue-600 p-2 rounded-lg">üîπ</span>
            Favicon
          </h2>
          <div
            class="border-2 border-dashed border-gray-300 p-6 rounded-xl hover:border-blue-500 transition-colors bg-gray-50 flex flex-col items-center justify-center text-center"
          >
            <input
              type="file"
              id="faviconFile"
              accept=".ico,.png"
              class="hidden"
              onchange="previewImage(this, 'faviconPreview')"
            />
            <label for="faviconFile" class="cursor-pointer">
              <div
                id="faviconPreview"
                class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center mb-3 mx-auto overflow-hidden"
              >
                <span class="text-3xl text-gray-400">+</span>
              </div>
              <span class="text-sm text-blue-600 font-medium hover:underline"
                >Choisir un fichier</span
              >
              <p class="text-xs text-gray-400 mt-1">.ico ou .png (32x32)</p>
            </label>
          </div>
          <div id="faviconStatus" class="min-h-[20px] text-xs"></div>
          <div class="hidden relative" id="faviconResult">
            <input
              type="text"
              readonly
              class="w-full text-xs bg-gray-50 border rounded p-2 pr-8"
              id="faviconUrl"
            />
            <button
              onclick="copyToClipboard('faviconUrl')"
              class="absolute right-2 top-1.5 text-gray-400 hover:text-blue-600"
            >
              üìã
            </button>
          </div>
        </div>

        <!-- Logo Section -->
        <div class="space-y-4">
          <h2
            class="font-semibold text-lg text-gray-700 flex items-center gap-2"
          >
            <span class="bg-indigo-100 text-indigo-600 p-2 rounded-lg">üî∏</span>
            Logo
          </h2>
          <div
            class="border-2 border-dashed border-gray-300 p-6 rounded-xl hover:border-indigo-500 transition-colors bg-gray-50 flex flex-col items-center justify-center text-center"
          >
            <input
              type="file"
              id="logoFile"
              accept=".png,.svg,.jpg"
              class="hidden"
              onchange="previewImage(this, 'logoPreview')"
            />
            <label for="logoFile" class="cursor-pointer">
              <div
                id="logoPreview"
                class="w-40 h-16 bg-gray-200 rounded-lg flex items-center justify-center mb-3 mx-auto overflow-hidden"
              >
                <span class="text-3xl text-gray-400">+</span>
              </div>
              <span class="text-sm text-indigo-600 font-medium hover:underline"
                >Choisir un fichier</span
              >
              <p class="text-xs text-gray-400 mt-1">.png, .svg (Transparent)</p>
            </label>
          </div>
          <div id="logoStatus" class="min-h-[20px] text-xs"></div>
          <div class="hidden relative" id="logoResult">
            <input
              type="text"
              readonly
              class="w-full text-xs bg-gray-50 border rounded p-2 pr-8"
              id="logoUrl"
            />
            <button
              onclick="copyToClipboard('logoUrl')"
              class="absolute right-2 top-1.5 text-gray-400 hover:text-indigo-600"
            >
              üìã
            </button>
          </div>
        </div>
      </div>

      <!-- Action Bar -->
      <div class="mt-10 pt-6 border-t flex flex-col items-center">
        <button
          onclick="uploadAllAssets()"
          class="px-8 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all font-bold text-lg flex items-center gap-2"
        >
          üöÄ Uploader Tout vers Cloudinary
        </button>
        <p class="mt-4 text-sm text-gray-500">
          Preset utilis√©: <code>assets_upload</code> ‚Ä¢ Dossier:
          <code>assets/</code>
        </p>
      </div>
    </div>

    <script>
      function previewImage(input, previewId) {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const previewDiv = document.getElementById(previewId);
            previewDiv.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-contain">`;
          };
          reader.readAsDataURL(file);
        }
      }

      function copyToClipboard(elementId) {
        const copyText = document.getElementById(elementId);
        copyText.select();
        navigator.clipboard.writeText(copyText.value);

        // Visual feedback
        const btn = copyText.nextElementSibling;
        const originalContent = btn.innerHTML;
        btn.innerHTML = "‚úÖ";
        setTimeout(() => (btn.innerHTML = originalContent), 1000);
      }

      async function uploadAllAssets() {
        const faviconFile = document.getElementById("faviconFile").files[0];
        const logoFile = document.getElementById("logoFile").files[0];

        if (!faviconFile && !logoFile) {
          alert("Veuillez s√©lectionner au moins un fichier (Favicon ou Logo).");
          return;
        }

        const tasks = [];

        if (faviconFile) tasks.push(uploadAsset(faviconFile, "favicon"));
        if (logoFile) tasks.push(uploadAsset(logoFile, "logo"));

        await Promise.all(tasks);
      }

      async function uploadAsset(file, type) {
        const statusDiv = document.getElementById(`${type}Status`);
        const resultDiv = document.getElementById(`${type}Result`);
        const urlInput = document.getElementById(`${type}Url`);

        statusDiv.innerHTML =
          '<span class="text-blue-600 animate-pulse">‚è≥ Upload en cours...</span>';
        resultDiv.classList.add("hidden");

        try {
          // Using 'assets_upload' preset for everything in this tool
          // We could optionally pass a public_id if we wanted to enforce naming like 'favicon' or 'logo_main'
          // But let's keep it flexible with generated IDs or original filenames for now, or user preferences?
          // User request usually implies replacing the system assets.
          // Let's try to overwrite if possible by suggesting a public_id if appropriate?
          // Stick to simple upload for now as per "uploader en m√™me temps".

          const result = await uploadToCloudinary(
            file,
            "assets_upload",
            "auto"
          );

          statusDiv.innerHTML =
            '<span class="text-green-600 font-bold">‚úì Upload termin√©</span>';
          urlInput.value = result.secure_url;
          resultDiv.classList.remove("hidden");
        } catch (error) {
          console.error(error);
          statusDiv.innerHTML = `<span class="text-red-600">‚ùå Erreur: ${error.message}</span>`;
        }
      }
    </script>
  </body>
</html>
