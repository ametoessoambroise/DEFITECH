<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erreur | DEFITECH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Lottie Player -->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <style>
        .animation-container {
            width: 300px;
            height: 300px;
            margin: 0 auto 2rem;
        }

        @media (max-width: 640px) {
            .animation-container {
                width: 250px;
                height: 250px;
            }
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center flex-col py-8">
    <div class="bg-white p-8 rounded-lg shadow-lg text-center max-w-md w-full mx-4">
        <div class="animation-container" id="animation-container">
            <!-- L'animation sera chargée ici dynamiquement -->
        </div>
        <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ title or 'Erreur' }}</h1>
        <p class="text-gray-700 mb-6">{{ message or "Une erreur est survenue." }}</p>
        <button onclick="history.back()"
            class="inline-flex items-center px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
            <i class="fas fa-arrow-left mr-2"></i>
            Revenir à la page précédente
        </button>
    </div>

    <!-- Footer -->
    <footer class="mt-8 text-center text-xs text-gray-500">
        <hr class="my-4">
        <div>
            <a href="/mentions-legales" class="hover:underline">Mentions légales</a> |
            <a href="/confidentialite" class="hover:underline">Politique de confidentialité</a>
        </div>
        <div class="mt-2">&copy; DEFITECH {{ current_year }}</div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Récupérer le code d'erreur depuis l'URL ou utiliser une valeur par défaut
            const urlParams = new URLSearchParams(window.location.search);
            const errorCode = urlParams.get('code') || '500'; // Code d'erreur par défaut

            // Définir les animations pour chaque code d'erreur
            const animations = {
                '404': "{{ url_for('static', filename='animations/wrong.json') }}",
                '401': "{{ url_for('static', filename='animations/505.json') }}",
                '403': "{{ url_for('static', filename='animations/forbidden403.json') }}",
                '400': "{{ url_for('static', filename='animations/wrong.json') }}",
                '500': "{{ url_for('static', filename='animations/wrong.json') }}",
                '505': "{{ url_for('static', filename='animations/wrong.json') }}",
                'default': "{{ url_for('static', filename='animations/wrong.json') }}"
            };

            // Sélectionner l'animation appropriée
            const animationPath = animations[errorCode] || animations['default'];

            // Créer et ajouter le lecteur Lottie
            const container = document.getElementById('animation-container');
            const lottiePlayer = document.createElement('lottie-player');

            lottiePlayer.setAttribute('src', animationPath);
            lottiePlayer.setAttribute('background', 'transparent');
            lottiePlayer.setAttribute('speed', '1');
            lottiePlayer.setAttribute('loop', '');
            lottiePlayer.setAttribute('autoplay', '');

            container.innerHTML = ''; // Vider le conteneur
            container.appendChild(lottiePlayer);

            // Gestion des erreurs de chargement
            lottiePlayer.addEventListener('error', function () {
                console.error('Erreur lors du chargement de l\'animation');
                container.innerHTML = `
                    <div class="text-yellow-500">
                        <i class="fas fa-exclamation-triangle text-6xl mb-4"></i>
                        <p class="text-sm mt-2">Erreur ${errorCode}</p>
                    </div>
                `;
            });
        });
    </script>
</body>

</html>