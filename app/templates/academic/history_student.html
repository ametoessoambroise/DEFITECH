{% extends "base.html" %} {% block title %}Mon Historique Académique |
DEFITECH{% endblock %} {% block content %}
<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">
      Mon Parcours Académique
    </h1>

    {% if not archives %}
    <div class="bg-white rounded-xl shadow-lg p-8 text-center">
      <div
        class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
      >
        <i class="fas fa-history text-blue-600 text-2xl"></i>
      </div>
      <h3 class="text-xl font-bold text-gray-900 mb-2">
        Aucune archive disponible
      </h3>
      <p class="text-gray-600">
        Vos résultats des années précédentes apparaîtront ici une fois les
        années clôturées administrativement.
      </p>
    </div>
    {% else %}
    <div class="grid gap-6">
      {% for archive in archives %}
      <div
        class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300"
      >
        <div class="p-6">
          <div class="flex justify-between items-start">
            <div>
              <h2 class="text-xl font-bold text-gray-900">
                {{ archive.annee_academique }}
              </h2>
              <p class="text-blue-600 font-medium">
                {{ archive.niveau }} - {{ archive.filiere_nom }}
              </p>
            </div>
            <span
              class="px-3 py-1 rounded-full text-sm font-bold {{ 'bg-green-100 text-green-800' if archive.decision_jury == 'ADMIS' else 'bg-red-100 text-red-800' }}"
            >
              {{ archive.decision_jury }}
            </span>
          </div>

          <div class="mt-6 grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-lg">
            <div class="text-center">
              <p class="text-xs text-gray-500 uppercase">Crédits Validés</p>
              <p class="text-2xl font-bold text-gray-900">
                {{ archive.credits_total_valides }} / 60
              </p>
            </div>
            <div class="text-center">
              <p class="text-xs text-gray-500 uppercase">Total Crédits</p>
              <p class="text-2xl font-bold text-gray-900">
                {{ archive.moyenne_generale }}
              </p>
            </div>
          </div>

          <div class="mt-6 flex justify-end space-x-4">
            <a
              href="{{ url_for('academic_history.view_archive', archive_id=archive.id) }}"
              class="inline-flex items-center text-blue-600 hover:text-blue-800 font-semibold"
            >
              <i class="fas fa-eye mr-2"></i> Détails
            </a>
            <a
              href="{{ url_for('admin_academic.download_transcript', student_id=current_user.etudiant_profile.id) if current_user.role == 'admin' else '#' }}"
              class="inline-flex items-center text-gray-400 cursor-not-allowed"
              title="Téléchargement disponible uniquement via admin pour l'instant"
            >
              <i class="fas fa-download mr-2"></i> Télécharger PDF
            </a>
            <!-- Note: Pour l'instant le download est sécurisé côté admin, à ouvrir pour students si voulu -->
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
