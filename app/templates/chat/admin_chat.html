<!DOCTYPE html>
<html lang="fr" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Chat Admin</title>

    <!-- Styles globaux -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/compiled.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      * {
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-family: "Inter", sans-serif;
        overscroll-behavior: none;
      }

      /* Sidebar Glass Effect */
      .glass-panel {
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-right: 1px solid rgba(255, 255, 255, 0.06);
      }

      /* Active Conversation */
      .active-user {
        background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.05) 100%);
        border-left: 3px solid #3b82f6;
        transform: translateX(3px);
      }

      /* Custom Scrollbar */
      .chat-scroll {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.1) transparent;
      }

      .chat-scroll::-webkit-scrollbar {
        width: 4px;
      }

      .chat-scroll::-webkit-scrollbar-track {
        background: transparent;
      }

      .chat-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
      }

      .chat-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      /* Message Bubbles */
      .msg-bubble {
        max-width: min(75%, 500px);
        padding: 12px 16px;
        border-radius: 16px;
        animation: slideUp 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        opacity: 0;
        transform: translateY(8px);
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .msg-sent {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
      }

      .msg-received {
        background: rgba(51, 65, 85, 0.9);
        color: #f1f5f9;
        border-bottom-left-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      @keyframes slideUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Conversation Item Hover */
      .conversation-item {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .conversation-item:hover {
        background: rgba(255, 255, 255, 0.05);
        transform: translateX(2px);
      }

      .conversation-item:active {
        transform: translateX(4px) scale(0.99);
      }

      /* Unread Badge Pulse */
      .unread-badge {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      @keyframes pulse {
        0%, 100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      /* Search Input Focus */
      .search-wrapper {
        transition: all 0.2s ease;
      }

      .search-wrapper:focus-within {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
      }

      /* Header Avatar Glow */
      .header-avatar {
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
      }

      /* Empty State Animation */
      .empty-state-icon {
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-15px); }
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .glass-panel {
          width: 100%;
          max-width: 320px;
          position: fixed;
          left: 0;
          top: 0;
          bottom: 0;
          z-index: 50;
          transform: translateX(-100%);
          transition: transform 0.3s ease;
        }

        .glass-panel.mobile-open {
          transform: translateX(0);
        }

        .msg-bubble {
          max-width: 85%;
          padding: 10px 14px;
        }
      }

      @media (max-width: 320px) {
        .glass-panel {
          max-width: 280px;
        }

        .msg-bubble {
          max-width: 90%;
          padding: 9px 12px;
          font-size: 14px;
        }
      }

      /* Status Indicator */
      .status-online {
        animation: statusPulse 2s ease-in-out infinite;
      }

      @keyframes statusPulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
        50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0); }
      }

      /* Input Focus Effect */
      .input-wrapper {
        transition: all 0.2s ease;
      }

      .input-wrapper:focus-within {
        transform: translateY(-1px);
        box-shadow: 0 -4px 12px rgba(59, 130, 246, 0.15);
      }

      /* Button Hover Effect */
      .btn-send {
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .btn-send:active {
        transform: scale(0.95);
      }

      /* Badge Glow */
      .badge-glow {
        box-shadow: 0 0 12px rgba(37, 99, 235, 0.5);
      }

      /* Safe Area for Mobile */
      @supports (padding: max(0px)) {
        .safe-top {
          padding-top: max(16px, env(safe-area-inset-top));
        }
        .safe-bottom {
          padding-bottom: max(16px, env(safe-area-inset-bottom));
        }
      }
    </style>
  </head>

  <body class="bg-slate-950 h-screen flex text-slate-100 overflow-hidden">
    <!-- App Lock Overlay -->
    {% if current_user.is_authenticated and current_user.is_app_lock_enabled %}
    {% include 'components/lock_screen.html' %}
    {% endif %}

    <!-- Mobile Menu Toggle -->
    <button
      id="mobile-menu-toggle"
      class="fixed top-4 left-4 z-50 w-10 h-10 bg-slate-800 rounded-full flex items-center justify-center md:hidden shadow-lg"
      onclick="toggleSidebar()"
    >
      <i class="fas fa-bars text-white"></i>
    </button>

    <!-- Sidebar (Conversation List) -->
    <aside id="sidebar" class="w-80 glass-panel flex flex-col z-40">
      <!-- Header -->
      <div class="safe-top h-16 flex items-center justify-between px-4 border-b border-white/5">
        <h1 class="font-bold text-lg flex items-center gap-2">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
            <i class="fas fa-shield-alt text-white text-sm"></i>
          </div>
          <span>Admin Chat</span>
        </h1>
        <span
          id="total-badge"
          class="badge-glow bg-gradient-to-r from-red-500 to-red-600 text-xs font-bold px-2.5 py-1 rounded-full shadow-lg"
          style="display: none;"
        >0</span>
      </div>

      <!-- Search -->
      <div class="p-3">
        <div class="search-wrapper relative bg-slate-800/80 rounded-xl border border-slate-700/50 focus-within:border-blue-500/50">
          <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-sm"></i>
          <input
            id="search-input"
            type="text"
            placeholder="Rechercher une conversation..."
            class="w-full bg-transparent rounded-xl pl-9 pr-3 py-2.5 text-sm text-slate-200 focus:outline-none placeholder-slate-500"
          />
        </div>
      </div>

      <!-- List -->
      <div
        id="conversation-list"
        class="flex-1 overflow-y-auto chat-scroll space-y-1 px-2 pb-2"
      >
        <!-- Items injected via JS -->
      </div>

      <!-- Bottom User Info -->
      <div class="safe-bottom p-4 border-t border-white/5 flex items-center gap-3 bg-slate-900/50">
        <div class="relative">
          <img
            src="{{ get_profile_picture(current_user) }}"
            class="w-10 h-10 rounded-full bg-slate-700 object-cover border-2 border-slate-700 shadow-lg"
            onerror="this.src='https://res.cloudinary.com/dmokvhpjt/image/upload/v1766894468/gep1294qd7tbddgvtmpj.png'"
            alt="Profile"
          />
          <div class="status-online absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-slate-900 rounded-full"></div>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-semibold truncate text-white">
            {{ current_user.prenom }} {{ current_user.nom }}
          </p>
          <p class="text-xs text-slate-400">Administrateur</p>
        </div>
        <a 
          href="/" 
          class="w-9 h-9 rounded-full hover:bg-red-500/10 active:bg-red-500/20 text-red-400 transition-colors flex items-center justify-center"
          title="Déconnexion"
        >
          <i class="fas fa-sign-out-alt text-sm"></i>
        </a>
      </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="flex-1 flex flex-col relative" style="background: linear-gradient(180deg, #0f172a 0%, #020617 100%);">
      <!-- Empty State -->
      <div
        id="no-chat-selected"
        class="absolute inset-0 flex flex-col items-center justify-center text-slate-500 px-4"
      >
        <div class="empty-state-icon w-24 h-24 bg-gradient-to-br from-slate-800 to-slate-900 rounded-full flex items-center justify-center mb-6 text-4xl shadow-2xl border border-slate-700">
          <i class="fas fa-inbox"></i>
        </div>
        <p class="text-lg font-medium text-center">Sélectionnez une conversation</p>
        <p class="text-sm text-slate-600 mt-2 text-center">Choisissez un utilisateur pour commencer à discuter</p>
      </div>

      <!-- Active Chat Header -->
      <header
        id="chat-header"
        class="safe-top h-16 border-b border-white/5 flex items-center justify-between px-4 sm:px-6 hidden bg-slate-900/80 backdrop-blur-md z-10"
      >
        <div class="flex items-center gap-3 min-w-0 flex-1">
          <button
            onclick="toggleSidebar()"
            class="w-9 h-9 rounded-full hover:bg-white/5 active:bg-white/10 flex items-center justify-center md:hidden flex-shrink-0"
          >
            <i class="fas fa-arrow-left text-sm"></i>
          </button>
          
          <img
            id="header-avatar"
            src=""
            class="header-avatar w-10 h-10 rounded-full bg-slate-700 object-cover flex-shrink-0 shadow-lg"
            alt="User avatar"
          />
          <div class="min-w-0 flex-1">
            <h2 id="header-name" class="font-semibold text-white text-sm sm:text-base truncate">
              Utilisateur
            </h2>
            <p id="header-role" class="text-xs text-slate-400 capitalize truncate">
              Role
            </p>
          </div>
        </div>
        <div class="flex gap-1 flex-shrink-0">
          <button
            onclick="markCurrentAsRead()"
            class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-green-500/10 active:bg-green-500/20 text-green-400 transition-colors"
            title="Marquer comme lu"
          >
            <i class="fas fa-check-double text-sm"></i>
          </button>
        </div>
      </header>

      <!-- Messages -->
      <div
        id="messages-container"
        class="flex-1 overflow-y-auto chat-scroll px-3 sm:px-6 py-4 space-y-3 sm:space-y-4 hidden"
        style="padding-bottom: 100px;"
      >
        <!-- Bubbles injected here -->
      </div>

      <!-- Input -->
      <div
        id="input-area"
        class="input-wrapper safe-bottom p-3 sm:p-4 border-t border-white/5 bg-slate-900/95 backdrop-blur-md hidden absolute bottom-0 left-0 right-0 z-10"
      >
        <form id="reply-form" class="flex items-end gap-2 sm:gap-3 max-w-4xl mx-auto">
          <div class="flex-1 bg-slate-800/80 rounded-2xl border border-slate-700/50 focus-within:border-blue-500/50 focus-within:bg-slate-800">
            <input
              id="reply-input"
              type="text"
              placeholder="Répondre..."
              autocomplete="off"
              maxlength="2000"
              class="w-full bg-transparent text-white text-sm sm:text-base px-3 sm:px-4 py-2.5 sm:py-3 focus:outline-none"
            />
          </div>
          <button
            type="submit"
            class="btn-send bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-5 sm:px-6 py-2.5 sm:py-3 rounded-full font-medium shadow-lg shadow-blue-600/30 flex-shrink-0 text-sm sm:text-base"
          >
            Envoyer
          </button>
        </form>
      </div>
    </main>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/app_lock.js') }}"></script>
    <script>
      // State
      const STATE = {
        adminId: "{{ current_user.id }}",
        activeUserId: null,
        conversations: [],
      };

      const DOM = {
        list: document.getElementById("conversation-list"),
        searchInput: document.getElementById("search-input"),
        noChat: document.getElementById("no-chat-selected"),
        header: document.getElementById("chat-header"),
        headerName: document.getElementById("header-name"),
        headerAvatar: document.getElementById("header-avatar"),
        headerRole: document.getElementById("header-role"),
        msgContainer: document.getElementById("messages-container"),
        inputArea: document.getElementById("input-area"),
        form: document.getElementById("reply-form"),
        input: document.getElementById("reply-input"),
        totalBadge: document.getElementById("total-badge"),
        sidebar: document.getElementById("sidebar"),
        mobileToggle: document.getElementById("mobile-menu-toggle"),
      };

      const socket = io();

      // ================= MOBILE SIDEBAR =================
      function toggleSidebar() {
        DOM.sidebar.classList.toggle('mobile-open');
        if (window.innerWidth < 768) {
          document.body.style.overflow = DOM.sidebar.classList.contains('mobile-open') ? 'hidden' : '';
        }
      }

      // Close sidebar when selecting conversation on mobile
      function closeSidebarOnMobile() {
        if (window.innerWidth < 768) {
          DOM.sidebar.classList.remove('mobile-open');
          document.body.style.overflow = '';
        }
      }

      // ================= INIT =================
      document.addEventListener("DOMContentLoaded", () => {
        fetchConversations();
        setupSocket();
        
        // Adjust for window resize
        window.addEventListener('resize', () => {
          if (window.innerWidth >= 768) {
            DOM.sidebar.classList.remove('mobile-open');
            document.body.style.overflow = '';
          }
        });
      });

      // ================= EVENTS =================
      DOM.searchInput.addEventListener("input", (e) => {
        renderList(e.target.value);
      });

      DOM.form.addEventListener("submit", (e) => {
        e.preventDefault();
        sendMessage();
      });

      DOM.input.addEventListener("keydown", (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      function setupSocket() {
        socket.on("receive_message", (data) => {
          if (
            STATE.activeUserId &&
            (data.sender_id == STATE.activeUserId ||
              data.receiver_id == STATE.activeUserId)
          ) {
            appendMessage(data);
            markAsRead(STATE.activeUserId);
          } else {
            playNotification();
          }
          fetchConversations();
        });

        socket.on("message_sent", (data) => {
          if (STATE.activeUserId === data.receiver_id) {
            appendMessage(data);
            fetchConversations();
          }
        });
      }

      // ================= LOGIC =================
      async function fetchConversations() {
        try {
          const res = await fetch("/chat/api/conversations");
          const data = await res.json();
          if (data.success) {
            STATE.conversations = data.conversations.sort(
              (a, b) =>
                new Date(b.last_message.timestamp) -
                new Date(a.last_message.timestamp)
            );
            renderList(DOM.searchInput.value);
          }
        } catch (e) {
          console.error("Failed to load conversations", e);
        }
      }

      function renderList(filterText = "") {
        DOM.list.innerHTML = "";
        let totalUnread = 0;

        const filtered = STATE.conversations.filter(
          (c) =>
            c.user.nom.toLowerCase().includes(filterText.toLowerCase()) ||
            c.user.prenom.toLowerCase().includes(filterText.toLowerCase())
        );

        filtered.forEach((c) => {
          const isActive = STATE.activeUserId === c.user.id;
          totalUnread += c.unread_count || 0;

          const div = document.createElement("div");
          div.className = `conversation-item p-3 rounded-xl cursor-pointer flex items-center gap-3 ${
            isActive ? "active-user" : ""
          }`;
          div.onclick = () => selectUser(c.user.id);

          const time = new Date(c.last_message.timestamp).toLocaleTimeString('fr-FR', {
            hour: "2-digit",
            minute: "2-digit",
          });
          const snippet =
            (c.last_message.is_from_me ? "Vous: " : "") + c.last_message.content;

          const avatarUrl = c.user.photo_profil
            ? c.user.photo_profil.startsWith("http")
              ? c.user.photo_profil
              : "/static/uploads/profile_pics/" + c.user.photo_profil
            : `https://ui-avatars.com/api/?name=${c.user.prenom}&background=3b82f6&color=fff`;

          div.innerHTML = `
            <div class="relative flex-shrink-0">
              <img src="${avatarUrl}" 
                   class="w-11 h-11 rounded-full object-cover bg-slate-700 border-2 border-slate-700 shadow-md"
                   onerror="this.src='https://ui-avatars.com/api/?name=${c.user.prenom}&background=3b82f6&color=fff'">
              ${
                c.unread_count > 0
                  ? `<div class="unread-badge absolute -top-1 -right-1 min-w-[18px] h-[18px] px-1 bg-gradient-to-r from-red-500 to-red-600 rounded-full text-[10px] flex items-center justify-center font-bold text-white border-2 border-slate-900 shadow-lg">${c.unread_count}</div>`
                  : ""
              }
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex justify-between items-start mb-1">
                <h4 class="font-semibold text-sm truncate text-white">${
                  c.user.prenom
                } ${c.user.nom}</h4>
                <span class="text-[10px] text-slate-500 flex-shrink-0 ml-2">${time}</span>
              </div>
              <p class="text-xs truncate ${
                c.unread_count > 0
                  ? "font-semibold text-slate-200"
                  : "text-slate-400"
              }">
                ${escapeHtml(snippet)}
              </p>
            </div>
          `;
          DOM.list.appendChild(div);
        });

        DOM.totalBadge.innerText = totalUnread;
        DOM.totalBadge.style.display = totalUnread > 0 ? "block" : "none";
      }

      async function selectUser(userId) {
        STATE.activeUserId = userId;

        const conv = STATE.conversations.find((c) => c.user.id === userId);
        if (!conv) return;

        // Update UI State
        DOM.noChat.classList.add("hidden");
        DOM.header.classList.remove("hidden");
        DOM.msgContainer.classList.remove("hidden");
        DOM.inputArea.classList.remove("hidden");

        DOM.headerName.innerText = `${conv.user.prenom} ${conv.user.nom}`;
        DOM.headerRole.innerText = conv.user.role || "Utilisateur";
        
        const avatarUrl = conv.user.photo_profil
          ? conv.user.photo_profil.startsWith("http")
            ? conv.user.photo_profil
            : `/static/uploads/profile_pics/${conv.user.photo_profil}`
          : `https://ui-avatars.com/api/?name=${conv.user.prenom}&background=3b82f6&color=fff`;
        
        DOM.headerAvatar.src = avatarUrl;

        // Re-render list
        renderList(DOM.searchInput.value);

        // Fetch History
        await loadTranscripts(userId);

        // Focus Input
        DOM.input.focus();

        // Mark read
        markAsRead(userId);

        // Close sidebar on mobile
        closeSidebarOnMobile();
      }

      async function loadTranscripts(userId) {
        DOM.msgContainer.innerHTML = "";
        try {
          const res = await fetch(`/chat/api/history?with=${userId}`);
          const data = await res.json();
          if (data.success) {
            data.messages.forEach(appendMessage);
            setTimeout(() => {
              DOM.msgContainer.scrollTop = DOM.msgContainer.scrollHeight;
            }, 100);
          }
        } catch (e) {
          console.error("Error loading history", e);
        }
      }

      function appendMessage(msg) {
        const isMe = msg.sender_id == STATE.adminId;
        const div = document.createElement("div");
        div.className = `flex ${isMe ? "justify-end" : "justify-start"}`;

        const time = new Date(msg.timestamp).toLocaleTimeString('fr-FR', {
          hour: "2-digit",
          minute: "2-digit",
        });

        div.innerHTML = `
          <div class="msg-bubble ${isMe ? "msg-sent" : "msg-received"}">
            <p class="text-sm whitespace-pre-wrap break-words leading-relaxed">${escapeHtml(
              msg.content
            )}</p>
            <p class="text-[9px] sm:text-[10px] mt-1.5 opacity-70 text-right ${isMe ? 'text-blue-100' : 'text-slate-400'}">
              ${time}
              ${isMe ? '<i class="fas fa-check text-[8px] ml-1"></i>' : ''}
            </p>
          </div>
        `;
        DOM.msgContainer.appendChild(div);
        setTimeout(() => {
          DOM.msgContainer.scrollTop = DOM.msgContainer.scrollHeight;
        }, 50);
      }

      function sendMessage() {
        const txt = DOM.input.value.trim();
        if (!txt || !STATE.activeUserId) return;

        socket.emit("send_message", {
          receiver_id: STATE.activeUserId,
          content: txt,
        });
        DOM.input.value = "";
      }

      function markAsRead(userId) {
        socket.emit("mark_as_read", { conversation_with: userId });
        const c = STATE.conversations.find((cv) => cv.user.id === userId);
        if (c) c.unread_count = 0;
        renderList(DOM.searchInput.value);
      }

      function markCurrentAsRead() {
        if (STATE.activeUserId) {
          markAsRead(STATE.activeUserId);
        }
      }

      function escapeHtml(text) {
        const n = document.createElement("div");
        n.textContent = text;
        return n.innerHTML;
      }

      function playNotification() {
        try {
          const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBixy0O7SjC8KHm7A7+OUQwwTYKvk67hcGAg+k9jxxHInBiho0e3YjzsLGGS57OShTwwLUrDo6axXFAxHouHyvmwhBilryO/VizMJHm/C8eSVRAwSY7Hm7bZaFgo7ktLvxXEpBSdt0ezahTgKGWO37+mlUQ0NURDU6qxeFAwHouHzv24iBihoy+/VizMKG2/C8uWVRQwTY7Hm7rBZFAk8ktPvxXEqBCdtz+zahTgKGWS47+mkUQ0NUhDV6ateFQ0IouHzwW8iByhr0e/VizQJG2/D8+WVRQwTZLHm7rBZFAo+ktTwxnEpByhuz+zahTcJGGS57+ejUQwNTxDU6atdFQ4IouHywW8iByhr0e/WizMKG27D8+WVRAwTZLHl7bFZFAo9ktTwxnEpByhuz+zahTcJGWW57+ejUQwNTxDU6KtdFQ4JouHywW8iByhr0e7WizMKG27D8+WVRAwTZLHl7bBZFAo9k9TwxnAqByhuz+3ahTcJGGS57+ijUQwNTxDU6KtdFQ4IouHywG8iCChr0e7WizMKG27D8+WVRAwTZLHl7bBYFAo9k9TwxnAqByhtz+3ahTcJGGS47+ijUQwNTxDU6KtdFQ4IouHywG8iCChr0e7WizMKG27D8+WVRAwTZLHl7bBYFAo9k9TwxnAqByhtz+3ahTcJGGS47+ijUQwNTxDU6KtdFQ4Iov==');
          audio.volume = 0.3;
          audio.play().catch(() => {})